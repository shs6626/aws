# EC2

AWS 클라우드 컴퓨팅 서비스 = 클라우드 가상 서버 (VM)

EC2 클라우드 가상 서버를 “인스턴스” 라고 부름

EC2 원격 접속 - SSH 연결 (Linux 인스턴스)

- SSH 프로토콜을 이요해 Linux 인스턴스에 원격으로 연결 및 파일 전송 가능
- SSH는 보안을 통해 원격으로 접속하기 위한 방식

EC2 원격 접속 - SSH 연결 (Windows 인스턴스)

- RDP 프로토콜을 이용해 Winodws 인스턴스에 원격으로 연결 및 파일 전송 가능
- RDP는 Windows OS를 원격으로 접속하기 위한 방식

### 인스턴스 구매 옵션

- 온디맨드 인스턴스
  - 사용한 만큼만 비용을 지불하는 인스턴스
  - 단기간 동안 예측할 수 없는 워크로드 및 중단되어서는 안되는 애플리케이션에 적합
- 예약 인스턴스
  - 1년 또는 3년 약정으로 구매하는 인스턴스
  - 최대 72% 저렴
  - 결제 옵션은 전체 선결제, 부분 선결제, 선결제 없음 3가지 선택 가능
- saving Plan
  - 1년 또는 3년 기간에 일정 사용량 약정(컴퓨팅 사용량에 대한 약정)으로 구매하는 인스턴스
  - Compute Saving Plans, EC2 Instance Saving Plans 2가지 유형이 있음
- 스팟 인스턴스
  - 사용하지 않는 예비 EC2 용량을 구매하여 사용하는 방식
  - 가장 저렴한 인스턴스 구매옵션
  - 수오에 따라 언제든지 인스턴스가 종료 될 수 있기 때문에 서버가 중단없이 지속적으로 실행 되어야하는 경우 사용 안하고 언제든지 시작 및 종료가 가능한 경우에 사용
- 전용 호스트 / 전용 인스턴스
  - 물리적인 전용 서버를 할당 받아 사용하는 방식
- 온디맨드 용량 예약
  - 특정 가용 영역의 EC2 인스턴스에 대해 원하는 기간만큼 컴퓨팅 용량을 예약하여 사용
  - 예약한 기간에 인스턴스를 사용하지 않아도 인스턴스 사용비용이 아닌 예약 비용은 청구됨

### 인스턴스 유형

인스턴스를 생성할 떄 지정하는 인스턴스 유형에 따라 컴퓨터의 하드웨어 사양이 결정됨

인스턴스 유형은 CPU, 메모리, 스토리지 및 네트워킹 용량의 여러 조합으로 구성 됨

### EC2 네트워킹 & 네트워크 인터페이스

인스턴스를 시작할 때 vpc에서 서브넷 선택 가능

인스턴스 시작시 네트워크 통신을 위해 기본 네트워크 인터페이스가 생성됨

인스턴스는 서브넷의 IP 주소 대역에서 프라이빗 IP 주소를 기본 네트워크 인터페이스에 할당

퍼블릭 IP 주소가 필요한 경우 네트워크 인터페이스에 할당

ENI (Elastic Network Interface)

가상 네트워크 인터페이스

IP주소, MAC 주소 등이 부여됨

인스턴스에 연결되어 네트워크 통신을 하는 역할

인스턴스 생성시 기본(primary) 네트워크 인터페이스가 IP 주소 등의 정보 할당과 함께 생성됨

EC2에 추가로 여러 개의 네트워크 인터페이스 연결 가능

인스턴스 유형에 따라 사용가능한 최대 네트워크 인터페이스 개수와 IP 주소 개수가 다름

하나 이상의 보안 그룹을 연결할 수 있음

네트워크 인터페이스는 동일한 가용 용역의 인스턴스에 연결 가능

### 보안 그룹 (Security Group)

EC2 인스턴스에 대한 인바운드 및 아웃바운드 트래픽을 제어하는 가상 방화벽 역할

- 인바운드 : 외부에서 EC2로 들어오는 트래픽
- 아웃바운드 : EC2인스턴스에서 외부로 나가는 트래픽
- 제어 규칙
  - 트래픽 유형 : SSH, HTTP
  - 프로토콜 : TCP, UDP
  - 포트 : SSH 22, HTTP 80
  - 대상 : 개별 IP 주소

EC2 인스턴스의 ENI 와 연결됨

보안 그룹은 허용 규칙만 지정 가능하고 거부 규칙은 지정할 수 없음

보안 그룹은 연결 상태를 추적하는 상태저장 방화벽 (Stateful Firewall)

- 아웃 바운드 규칙에 상관없이, 허용된 인바운드 트래픽에 대한 반응으로 외부에 나가는 흐름이 수행
- 사용자가 인스턴스에 요청을 전송하면 해당 요청의 응답 트래픽은 인바운드 보안 규칙에 관계없이 인바운드 흐름이 허용

### 탄력적 IP (Elastic IP)

public IP : 인터넷 연결에 사용하는 IP

private IP : 회사나 집의 내부에서만 사용하는 IP, 직접적으로 인터넷 연결이 안되며 인터넷 게이트웨이를 통해야 함

**Elastic IP**

- 인스턴스 재생성시 자동으로 할당 받은 Public IP 는 인스턴스를 재시작 하면 다른 IP로 재할당 받기에 Public IP 주소가 변경됨
- Elastic IP는 인터넷에 연결 가능한 고정적인 public IP 주소
- EC2 인스턴스의 ENI에 탄력적 IP 주소를 연결하면 EC2 인스턴스를 다시 시작해도 동일한 Public IP 주소로 접속 할 수 있음
- Elastic IP는 생성한 리전 내에서만 사용 가능하며 다른 리전으로 이전할 수 없음
- 실행 중인 인스턴스와 연결되지 않은 탄력적 IP 주소에 대해서는 소액의 시간당 요금이 부과 됨

### Amazon Machine Image (AMI)

인스턴스를 시작하는 데 필요한 소프트웨어 구성(운영체제, 애플리케이션 서버 및 애플리케이션)이 포함된 템플릿

EC2 인스턴스를 시작하는데 AMI 지정해야 하며 EC2 인스턴스 시작시 os 설치나 서버 소프트웨어 설정등을 별도로 할 필요 없음

운영중인 EC2 인스턴스를 커스텀 AMI로 만들어서 동일한 환경으로 구성된 EC2를 빠르게 시작 가능

### 배치 그룹 (Placement Groups)

배치 그룹을 사용하여 사용자가 EC2 인스턴스 그룹의 배치를 구성할 수 있음

- 클러스터 배치그룹
  - 단일 가용영역 내의 인스턴스를 고속 네트워크로 연결하여 그룹화 한 것
  - 짧은 네트워크 지연시간, 높은 네트워크 처리량을 제공
  - 고성능 컴퓨팅 (HPC) 애플리케이션에 적합
- 파티션 배치 그룹
  - 하드웨어를 파티션으로 그룹화
  - 하나의 하드웨어 장애 발생시 다른 하드웨어에 영향이 없음 (파티션 간 장애의 영향을 분리 가능)
  - 각 파티션 마다 별도의 서버, 네트워크로 구성된 서로 다른 하드웨어 사용
  - 빅데이터 분산 처리 시스템에 사용
- 분산형 배치 그룹
  - 각각 고유한 하드웨어에 배치된 인스턴스 그룹
  - 각 개별 인스턴스가 서로 다른 하드웨어에 배치됨
  - 하나의 그룹당 가용영역별로 최대 7개의 실행중인 인스턴스를 가질 수 있음
  - 분산 그룹의 인스턴스는 동일한 하드웨어를 사용하지 않으므로 장애 발생시 안전
  - 매우 중요하고 고가용성이 필요한 애플리케이션에 적합
